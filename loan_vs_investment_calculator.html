<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>信贷与定投收益计算器（韩信点兵）</title>
  <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      max-width: 700px;
      margin: 20px auto;
      padding: 0 15px;
      background: #f9f9f9;
      color: #333;
    }
    h1 {
      text-align: center;
      margin-bottom: 1em;
    }
    form {
      background: #fff;
      padding: 15px 20px;
      border-radius: 6px;
      box-shadow: 0 2px 6px rgb(0 0 0 / 0.1);
      margin-bottom: 2em;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: 600;
    }
    input[type="number"] {
      width: 100%;
      padding: 8px 10px;
      font-size: 1em;
      margin-top: 6px;
      border-radius: 4px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    button {
      margin-top: 15px;
      padding: 10px 20px;
      background: #409eff;
      border: none;
      color: #fff;
      font-weight: 600;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    button:hover {
      background: #66b1ff;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      box-shadow: 0 2px 6px rgb(0 0 0 / 0.1);
      border-radius: 6px;
      overflow: hidden;
      margin-bottom: 2em;
      font-size: 0.9em;
    }
    th, td {
      text-align: center;
      padding: 12px 8px;
      border-bottom: 1px solid #eee;
    }
    th {
      background: #409eff;
      color: white;
      font-weight: 600;
    }
    tr:last-child td {
      border-bottom: none;
    }
    .formula {
      background: #fff;
      padding: 15px 20px;
      border-radius: 6px;
      box-shadow: 0 2px 6px rgb(0 0 0 / 0.1);
      line-height: 1.5em;
      font-family: "Courier New", Courier, monospace;
      white-space: pre-wrap;
      font-size: 0.95em;
    }
    .warning {
      color: #d9534f;
      font-weight: bold;
      margin-top: 10px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div id="app">
    <h1>信贷与定投收益计算器（韩信点兵）</h1>
    <form @submit.prevent="calculate">
      <label for="loanPrincipal">贷款本金（元）</label>
      <input id="loanPrincipal" type="number" v-model.number="loanPrincipalInput" min="1" step="1" required />

      <label for="loanRate">贷款年利率（%）</label>
      <input id="loanRate" type="number" v-model.number="loanRate" min="0" step="0.01" required />

      <label for="loanTerm">贷款期限（年）</label>
      <input id="loanTerm" type="number" v-model.number="loanTerm" min="1" step="1" required />

      <label for="monthlyCashFlow">每月可用还款金额（元）</label>
      <input id="monthlyCashFlow" type="number" v-model.number="monthlyCashFlow" min="1" step="1" required />

      <label for="fundRate">基金年化收益率（%）</label>
      <input id="fundRate" type="number" v-model.number="fundRate" min="0" step="0.01" required />

      <label for="lumpSumBeta">一次性投入时选择的beta</label>
      <input id="lumpSumBeta" type="number" v-model.number="lumpSumBeta" min="0" step="0.01" required />

      <button type="submit">计算</button>
    </form>

    <div v-if="calculated">
      <table>
        <thead>
          <tr>
            <th>项目</th>
            <th>数值</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>贷款本金</td>
            <td>{{ formatNumber(loanPrincipalInput) }} 元</td>
          </tr>
          <tr>
            <td>贷款期限（月）</td>
            <td>{{ totalMonths }} 月</td>
          </tr>
          <tr>
            <td>月利率</td>
            <td>{{ (monthlyLoanRate * 100).toFixed(4) }} %</td>
          </tr>
          <tr>
            <td>每月应还款额（本金+利息）</td>
            <td>{{ formatNumber(monthlyRepayment) }} 元</td>
          </tr>
          <tr>
            <td>每月可用还款金额</td>
            <td>{{ formatNumber(monthlyCashFlow) }} 元</td>
          </tr>
          <tr v-if="monthlyCashFlow < monthlyRepayment" class="warning">
            <td colspan="2">警告：每月可用还款金额不足以支付贷款月还款！</td>
          </tr>
          <tr>
            <td>贷款总还款额</td>
            <td>{{ formatNumber(totalLoanRepayment) }} 元</td>
          </tr>
          <tr>
            <td>贷款总利息</td>
            <td>{{ formatNumber(totalLoanRepayment - loanPrincipalInput) }} 元</td>
          </tr>
          <tr>
            <td>一次性投入系数 beta</td>
            <td>{{ lumpSumBeta.toFixed(2) }}</td>
          </tr>
          <tr>
            <td>贷款方案一次性投入基金{{ loanTerm }}年后价值</td>
            <td>{{ formatNumber(fundValueLumpSum) }} 元</td>
          </tr>
          <tr>
            <td>贷款方案净收益（基金价值 - 总还款）</td>
            <td>{{ formatNumber(netProfitLumpSum) }} 元</td>
          </tr>
          <tr>
            <td>每月定投基金{{ loanTerm }}年后价值</td>
            <td>{{ formatNumber(fundValueMonthly) }} 元</td>
          </tr>
          <tr>
            <td>每月定投累计投入本金</td>
            <td>{{ formatNumber(totalMonthlyInvestment) }} 元</td>
          </tr>
          <tr>
            <td>每月定投方案净收益</td>
            <td>{{ formatNumber(netProfitMonthly) }} 元</td>
          </tr>
          <tr style="font-weight: bold; background: #f0f9ff;">
            <td>净收益差额（贷款方案 - 每月定投）</td>
            <td>{{ formatNumber(netProfitLumpSum - netProfitMonthly) }} 元</td>
          </tr>
        </tbody>
      </table>

      <!-- 新增还款明细表 -->
      <h2>等额本息还款明细（前12个月）</h2>
      <table>
        <thead>
          <tr>
            <th>月份</th>
            <th>月供（元）</th>
            <th>利息（元）</th>
            <th>本金（元）</th>
            <th>剩余本金（元）</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="item in repaymentSchedule" :key="item.month">
            <td>{{ item.month }}</td>
            <td>{{ formatNumber(item.monthlyRepayment) }}</td>
            <td>{{ formatNumber(item.interest) }}</td>
            <td>{{ formatNumber(item.principal) }}</td>
            <td>{{ formatNumber(item.balance < 0 ? 0 : item.balance) }}</td>
          </tr>
        </tbody>
      </table>

    </div>

    <div v-if="calculated" class="formula">
贷款本金 P = {{ formatNumber(loanPrincipalInput) }} 元  
贷款年利率 = {{ loanRate }} %  
贷款期限 = {{ loanTerm }} 年（共 {{ totalMonths }} 月）  
月利率 r = {{ monthlyLoanRate.toFixed(6) }}  

每月应还款额 M = P × [ r(1+r)^n / ((1+r)^n -1) ]  
(1+r)^n = {{ pow1rN.toFixed(6) }}  
还款系数 = {{ repaymentFactor.toFixed(8) }}  

计算：
M = {{ loanPrincipalInput }} × {{ repaymentFactor.toFixed(8) }} = {{ monthlyRepayment.toFixed(2) }} 元

---

贷款总还款额 = M × n = {{ monthlyRepayment.toFixed(2) }} × {{ totalMonths }} = {{ totalLoanRepayment.toFixed(2) }} 元  
贷款总利息 = 总还款额 - 贷款本金 = {{ (totalLoanRepayment - loanPrincipalInput).toFixed(2) }} 元

---

一次性投入系数 beta = {{ lumpSumBeta }}  
贷款本金一次性投入基金{{ loanTerm }}年后价值：  
FV = P × beta × (1 + 基金年化收益率)^年数  
= {{ loanPrincipalInput }} × {{ lumpSumBeta }} × (1 + {{ fundRate }}%)^{{ loanTerm }}  
= {{ fundValueLumpSum.toFixed(2) }} 元

---

每月定投基金价值计算：  
FV = P × [ (1 + r)^n - 1 ] ÷ r × (1 + r)  
其中：  
P = 每月定投 = {{ monthlyCashFlow }} 元  
r = 月基金收益率 = {{ monthlyFundRate.toFixed(6) }}  
n = {{ totalMonths }}

计算：  
(1 + r)^n = {{ pow1rN_Fund.toFixed(6) }}  

FV = {{ monthlyCashFlow }} × [ {{ pow1rN_Fund.toFixed(6) }} - 1 ] ÷ {{ monthlyFundRate.toFixed(6) }} × (1 + {{ monthlyFundRate.toFixed(6) }})  
= {{ fundValueMonthly.toFixed(2) }} 元

累计投入本金 = {{ monthlyCashFlow }} × {{ totalMonths }} = {{ totalMonthlyInvestment.toFixed(2) }} 元  
定投方案净收益 = 基金价值 - 累计投入本金 = {{ netProfitMonthly.toFixed(2) }} 元
    </div>
  </div>

  <script>
    new Vue({
      el: "#app",
      data: {
        loanPrincipalInput: 100000, // 贷款本金输入
        loanRate: 3,                // 年利率 %
        loanTerm: 7,                // 年
        monthlyCashFlow: 1500,      // 每月可用还款额
        fundRate: 18,               // 基金年化收益率 %
        lumpSumBeta: 1,             // 一次性投入系数 beta，默认1
        calculated: false,

        monthlyLoanRate: 0,
        totalMonths: 0,
        pow1rN: 0,
        repaymentFactor: 0,
        monthlyRepayment: 0,
        totalLoanRepayment: 0,
        fundValueLumpSum: 0,
        netProfitLumpSum: 0,
        monthlyFundRate: 0,
        pow1rN_Fund: 0,
        fundValueMonthly: 0,
        totalMonthlyInvestment: 0,
        netProfitMonthly: 0,

        repaymentSchedule: [],
      },
      methods: {
        calculate() {
          this.totalMonths = this.loanTerm * 12;
          this.monthlyLoanRate = this.loanRate / 100 / 12;
          this.monthlyFundRate = this.fundRate / 100 / 12;

          this.pow1rN = Math.pow(1 + this.monthlyLoanRate, this.totalMonths);
          this.repaymentFactor = (this.monthlyLoanRate * this.pow1rN) / (this.pow1rN - 1);

          this.monthlyRepayment = this.loanPrincipalInput * this.repaymentFactor;
          this.totalLoanRepayment = this.monthlyRepayment * this.totalMonths;

          // 一次性投入计算乘以beta
          this.fundValueLumpSum = this.loanPrincipalInput * this.lumpSumBeta * Math.pow(1 + this.fundRate / 100, this.loanTerm);
          this.netProfitLumpSum = this.fundValueLumpSum - this.totalLoanRepayment;

          this.pow1rN_Fund = Math.pow(1 + this.monthlyFundRate, this.totalMonths);
          this.fundValueMonthly = this.monthlyCashFlow * ((this.pow1rN_Fund - 1) / this.monthlyFundRate) * (1 + this.monthlyFundRate);
          this.totalMonthlyInvestment = this.monthlyCashFlow * this.totalMonths;
          this.netProfitMonthly = this.fundValueMonthly - this.totalMonthlyInvestment;

          // 计算还款明细，默认显示前12个月（如果期限小于12个月则显示全部）
          this.repaymentSchedule = [];
          let balance = this.loanPrincipalInput;
          const showMonths = Math.min(this.totalMonths, 12);
          for (let month = 1; month <= showMonths; month++) {
            const interest = balance * this.monthlyLoanRate;
            const principal = this.monthlyRepayment - interest;
            balance -= principal;
            this.repaymentSchedule.push({
              month,
              monthlyRepayment: this.monthlyRepayment,
              interest,
              principal,
              balance,
            });
          }

          this.calculated = true;
        },
        formatNumber(num) {
          return num.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        },
      },
    });
  </script>
</body>
</html>

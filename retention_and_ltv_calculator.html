<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>维持率风险计算器（含LTV计算基准）</title>
  <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      max-width: 640px;
      margin: 20px auto;
      padding: 0 15px;
      background: #f7fafc;
      color: #333;
    }
    h1 {
      text-align: center;
      margin-bottom: 1rem;
      color: #0b3d91;
      font-weight: 700;
    }
    form {
      background: #fff;
      padding: 20px 25px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 1.5rem;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: 600;
      color: #1e293b;
    }
    input[type="number"], select {
      width: 100%;
      padding: 8px 10px;
      margin-top: 6px;
      font-size: 1rem;
      border: 1px solid #cbd5e1;
      border-radius: 5px;
      box-sizing: border-box;
      transition: border-color 0.3s ease;
    }
    input[type="number"]:focus, select:focus {
      border-color: #2563eb;
      outline: none;
    }
    button {
      margin-top: 20px;
      width: 100%;
      padding: 12px 0;
      background-color: #0b3d91;
      color: white;
      font-weight: 700;
      font-size: 1.1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #0a357c;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      border-radius: 8px;
      overflow: hidden;
      font-size: 1rem;
    }
    th, td {
      padding: 12px 10px;
      border-bottom: 1px solid #e2e8f0;
      text-align: center;
      color: #334155;
    }
    th {
      background: #0b3d91;
      color: white;
      font-weight: 700;
    }
    tr:last-child td {
      border-bottom: none;
    }
    .text-green {
      color: #15803d;
      font-weight: 700;
    }
    .text-orange {
      color: #b45309;
      font-weight: 700;
    }
    .text-red {
      color: #b91c1c;
      font-weight: 700;
    }
    .font-weight-bold {
      font-weight: 900 !important;
    }
    .note {
      background: #e0f2fe;
      border-left: 4px solid #0b3d91;
      padding: 15px 20px;
      margin-top: 20px;
      border-radius: 6px;
      font-size: 0.95rem;
      color: #1e40af;
      line-height: 1.5;
      white-space: pre-wrap;
      font-family: "Courier New", Courier, monospace;
    }
    .info-icon {
      display: inline-block;
      width: 16px;
      height: 16px;
      margin-left: 6px;
      border-radius: 50%;
      background: #0b3d91;
      color: white;
      text-align: center;
      font-size: 14px;
      line-height: 16px;
      cursor: help;
      user-select: none;
    }
  </style>
</head>
<body>
  <div id="app" role="main">
    <h1>维持率风险计算器（含LTV计算基准）</h1>
    <form @submit.prevent="calculate" aria-label="维持率风险计算表单">

      <label for="assetValue">资产市值（港币万元）</label>
      <input id="assetValue" type="number" v-model.number="assetValue" min="0.01" step="0.01" required aria-describedby="assetValueHelp" />
      <small id="assetValueHelp">您当前持有资产的市场价值</small>

      <label for="creditRatio">信贷率（%）</label>
      <input id="creditRatio" type="number" v-model.number="creditRatio" min="1" max="100" step="0.1" required aria-describedby="creditRatioHelp" />
      <small id="creditRatioHelp">资产可抵押贷款的最大比例（如70表示70%）</small>

      <label for="loanAmount">贷款余额（港币万元）</label>
      <input id="loanAmount" type="number" v-model.number="loanAmount" :max="maxLoanAmount" min="0" step="0.01" required aria-describedby="loanAmountHelp" />
      <small id="loanAmountHelp">您当前未偿还的贷款金额（不能超过最大贷款额度 {{ formatNumber(maxLoanAmount) }} 万）</small>

      <label for="ltvBase">LTV 计算基准
        <span class="info-icon" title="选择用总资产市值或有效抵押物市值作为LTV计算的分母">i</span>
      </label>
      <select id="ltvBase" v-model="ltvBase" aria-describedby="ltvBaseHelp">
        <option value="totalAsset">总资产市值</option>
        <option value="effectiveCollateral">有效抵押物市值</option>
      </select>
      <small id="ltvBaseHelp">选择LTV计算时的资产基准</small>

      <label for="maintenanceMargin">维持保证金比例（%）</label>
      <input id="maintenanceMargin" type="number" v-model.number="maintenanceMargin" min="50" max="150" step="0.1" required aria-describedby="maintenanceMarginHelp" />
      <small id="maintenanceMarginHelp">低于此比例时触发追加保证金（一般60%~100%之间）</small>

      <button type="submit">计算维持率及风险</button>
    </form>

    <table v-if="calculated" aria-live="polite" aria-label="计算结果">
      <thead>
        <tr>
          <th>项目</th>
          <th>数值</th>
          <th>说明</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>资产市值</td>
          <td>{{ formatNumber(assetValue) }} 万港币</td>
          <td>当前持有资产的市场价值</td>
        </tr>
        <tr>
          <td>信贷率</td>
          <td>{{ creditRatio.toFixed(2) }} %</td>
          <td>资产可抵押贷款的最大比例</td>
        </tr>
        <tr>
          <td>最大可贷金额</td>
          <td>{{ formatNumber(maxLoanAmount) }} 万港币</td>
          <td>资产市值 × 信贷率</td>
        </tr>
        <tr>
          <td>贷款余额</td>
          <td>{{ formatNumber(loanAmount) }} 万港币</td>
          <td>当前未偿还贷款金额</td>
        </tr>
        <tr>
          <td>LTV (贷款余额 ÷ 计算基准)</td>
          <td :class="ltvClass">{{ ltv.toFixed(2) }} %</td>
          <td>贷款余额 ÷ {{ ltvBaseName }}</td>
        </tr>
        <tr>
          <td>维持率 (计算基准 ÷ 贷款余额)</td>
          <td :class="maintenanceRateClass">{{ maintenanceRate.toFixed(2) }} %</td>
          <td>计算基准 ÷ 贷款余额 × 100%</td>
        </tr>
        <tr>
          <td>风险状态</td>
          <td :class="riskClass" colspan="2">{{ riskMessage }}</td>
        </tr>
      </tbody>
    </table>

    <div class="note" v-if="calculated" aria-label="计算说明">
      计算说明：

      - 最大可贷金额 = 资产市值 × 信贷率
      - 贷款余额不能超过最大可贷金额
      - LTV = 贷款余额 ÷ 计算基准 × 100%，计算基准根据选择为总资产市值或有效抵押物市值（资产市值 × 信贷率）
      - 维持率 = 计算基准 ÷ 贷款余额 × 100%，反映资产价值相对于贷款的安全边际
      - 维持保证金比例为银行设定的风险阈值，低于此比例时会触发追加保证金（Margin Call）
      - 若贷款余额为0，视为无风险，维持率显示为无穷大
      - 维持率越高，风险越低；低于维持保证金比例时，风险较高，有追加保证金的可能性
    </div>
  </div>

  <script>
    new Vue({
      el: "#app",
      data() {
        return {
          assetValue: 100,  // 万港币
          creditRatio: 70,  // %
          loanAmount: 60,   // 万港币
          maintenanceMargin: 100, // %
          ltvBase: "totalAsset",  // 计算基准，"totalAsset" 或 "effectiveCollateral"
          calculated: false,
        };
      },
      computed: {
        maxLoanAmount() {
          return this.assetValue * (this.creditRatio / 100);
        },
        ltvBaseValue() {
          if (this.ltvBase === "effectiveCollateral") {
            return this.assetValue * (this.creditRatio / 100);
          }
          return this.assetValue;
        },
        ltvBaseName() {
          return this.ltvBase === "effectiveCollateral" ? "有效抵押物市值" : "总资产市值";
        },
        ltv() {
          if (this.loanAmount === 0) return 0;
          return (this.loanAmount / this.ltvBaseValue) * 100;
        },
        maintenanceRate() {
          if (this.loanAmount === 0) return Infinity;
          return (this.ltvBaseValue / this.loanAmount) * 100;
        },
        ltvClass() {
          if (this.loanAmount === 0) return "text-green font-weight-bold";
          if (this.ltv <= this.creditRatio) return "text-green font-weight-bold";
          if (this.ltv <= this.creditRatio * 1.2) return "text-orange font-weight-bold";
          return "text-red font-weight-bold";
        },
        maintenanceRateClass() {
          if (this.loanAmount === 0) return "text-green font-weight-bold";
          if (this.maintenanceRate >= this.maintenanceMargin) return "text-green font-weight-bold";
          if (this.maintenanceRate >= this.maintenanceMargin * 0.8) return "text-orange font-weight-bold";
          return "text-red font-weight-bold";
        },
        riskMessage() {
          if (this.loanAmount === 0) return "无贷款，无风险。";
          if (this.maintenanceRate >= this.maintenanceMargin) return "安全：维持率高于保证金比例，无需追加保证金。";
          if (this.maintenanceRate >= this.maintenanceMargin * 0.8) return "警告：维持率接近保证金比例，注意风险。";
          return "危险：维持率低于保证金比例，可能触发追加保证金。";
        },
        riskClass() {
          return this.maintenanceRateClass;
        }
      },
      methods: {
        calculate() {
          if (this.assetValue <= 0) {
            alert("资产市值必须大于0");
            return;
          }
          if (this.creditRatio <= 0 || this.creditRatio > 100) {
            alert("信贷率应介于1%到100%之间");
            return;
          }
          if (this.loanAmount < 0) {
            alert("贷款余额不能为负数");
            return;
          }
          if (this.loanAmount > this.maxLoanAmount) {
            alert(`贷款余额不能超过最大贷款额度 ${this.formatNumber(this.maxLoanAmount)} 万`);
            return;
          }
          if (this.maintenanceMargin < 50 || this.maintenanceMargin > 150) {
            alert("维持保证金比例应在50%至150%之间");
            return;
          }
          this.calculated = true;
        },
        formatNumber(num) {
          if (num === Infinity) return "∞";
          return num.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        },
      },
      watch: {
        assetValue() {
          if (this.loanAmount > this.maxLoanAmount) {
            this.loanAmount = this.maxLoanAmount;
          }
        },
        creditRatio() {
          if (this.loanAmount > this.maxLoanAmount) {
            this.loanAmount = this.maxLoanAmount;
          }
        }
      },
      mounted() {
        this.calculate();
      },
    });
  </script>
</body>
</html>
